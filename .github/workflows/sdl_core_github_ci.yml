name: GitHub Actions Demo
on: [push]
jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v2
    - name: submodules
      run: git -C ${{ github.workspace }} submodule update --init --recursive
    # install dependencies
    - name: install-dependencies
      run: sudo apt-get update && sudo apt-get install libssl-dev libbluetooth3 libbluetooth-dev libudev-dev cmake html2text lcov git cmake automake1.11 build-essential libavahi-client-dev sqlite3 libsqlite3-dev libgtest-dev bluez-tools libpulse-dev libusb-1.0.0-dev cppcheck python3-pip python3-setuptools && sudo apt-get install -f clang-format-6.0
    - name: Setup cmake
      uses: jwlawson/actions-setup-cmake@v1.8
      with:
        cmake-version: '3.16.3'
    # build project
    - name: mkdir-and-cd
      run: cd ${{ github.workspace }} && cd ../ && mkdir build && cd build
    - name: log-cmake-version
      run: cmake --version
    - name: cmake
      run: cmake ../sdl_core -DBUILD_TESTS=ON
    - name: build
      run: make install-3rd_party && make -j `nproc` install && sudo ldconfig
    # run tests
    - name: run test 1
      run: make test
